# AMD1-1_Alpha: Complete Alpha Personalization Implementation

## Executive Summary

This document provides a comprehensive explanation of the AMD1-1_Alpha project, which implements a sophisticated LinkedIn post-click personalization system with RAD (Retrieval-Augmented Data) enrichment integration.

**Updated: 2026-01-27** - Now features a guided experience with dropdown menus for explicit signal capture.

---

## What Is This Project?

AMD1-1_Alpha is an **AMD Campaign Personalization Engine** that transforms LinkedIn ad clicks into highly personalized content experiences through a guided form. When a user lands on the page, they:

1. **Complete guided form** with explicit selections for company, role, modernization stage, and AI priority
2. **Submit work email** for additional enrichment via Apollo.io and PeopleDataLabs APIs
3. **Receive personalized content** generated by Claude AI based on their selections and enriched data
4. **View tailored experience** with customized headline, subheadline, value props, and CTA (under 60 seconds)

---

## System Architecture

### High-Level Flow

```
LinkedIn Ad → AMD Campaign Landing Page
    ↓
Guided Form Experience (6 fields)
    ├─ Company (text input)
    ├─ Role (dropdown: Business Leader, IT, Finance, Operations, Security)
    ├─ Modernization Stage (dropdown: Exploring, Evaluating, Ready to Implement)
    ├─ AI Priority (dropdown: Infrastructure, AI/ML, Cloud, Data Center, etc.)
    ├─ Work Email (required for enrichment)
    └─ Name (optional for personalization)
    ↓
Form Submission → API Route
    ↓
RAD Enrichment (10-20s)
    ├─ Apollo.io API (parallel)
    ├─ PeopleDataLabs API (parallel)
    ├─ Enriches domain from email
    └─ LLM Conflict Resolution
    ↓
Template Selection (<1s)
    ├─ Uses role selection (not inferred)
    ├─ Uses modernization stage (not inferred)
    ├─ Scores templates by relevance
    └─ Select best-fit template
    ↓
LLM Adaptation (5-10s)
    ├─ Claude 3.5 Sonnet
    ├─ Uses company name from form
    ├─ Uses AI priority for context
    ├─ Fill template variables
    └─ Adapt tone and messaging
    ↓
Personalized Content Display (<60s total)
    ├─ Headline + Subheadline
    ├─ 3 Value Propositions
    ├─ Personalized CTA
    └─ Metadata badges (company, role, stage, AI priority)
```

### Component Architecture

```
Frontend (Vercel - Next.js)
├── Landing Page (/app/page.tsx)
├── Email Form (/app/components/EmailForm.tsx)
├── Results Display (/app/components/PersonalizedResults.tsx)
└── API Routes (/app/api/personalize/route.ts)

Backend Services
├── RAD Enrichment (/lib/enrichment/rad-client.ts)
├── Template Engine (/lib/personalization/template-engine.ts)
├── LLM Adapter (/lib/personalization/llm-adapter.ts)
└── Anthropic Client (/lib/anthropic/client.ts)

Data Layer (Supabase)
├── personalization_jobs (user submissions + enrichment)
├── personalization_outputs (generated content)
└── enrichment_cache (24-hour cache for performance)
```

---

## Guided Experience (New in 2026-01-27)

### Why Guided Form?

**Problem with Inference:**
- Email-based persona inference was unreliable (not all IT people have `it@` emails)
- CTA-based buyer stage inference was limited
- Users had no way to express AI priorities
- Company names had to be looked up (limited database)

**Solution: Explicit User Input:**
- Users select their role directly (Business Leader, IT, Finance, Operations, Security)
- Users select their modernization stage directly (Exploring, Evaluating, Ready to Implement)
- Users provide company name (no lookup needed)
- Users specify AI priority (Infrastructure, AI/ML, Cloud Migration, etc.)

### Guided Form Fields

| Field | Type | Required | Options | Purpose |
|-------|------|----------|---------|---------|
| Company | Text Input | Yes | Free text | Company name for personalization |
| Role | Dropdown | Yes | Business Leader, IT, Finance, Operations, Security | Sets persona directly |
| Modernization Stage | Dropdown | Yes | Exploring & Learning, Evaluating & Comparing, Ready to Implement | Sets buyer stage directly |
| AI Priority | Dropdown | Yes | Infrastructure Modernization, AI/ML Workloads, Cloud Migration, Data Center Optimization, Performance & Scalability, Cost Optimization | Captures key signal for AMD |
| Work Email | Text Input | Yes | Valid email format | For domain enrichment |
| Name | Text Input | No | Free text | Optional personalization |
| Consent | Checkbox | Yes | Yes/No | Compliance requirement |

### Data Flow

**Before (Inference-Based):**
```
Email: security@stripe.com + CTA: compare
↓
Infer persona: "Security" (from email prefix)
Infer buyer stage: "Evaluation" (from CTA parameter)
Look up company: "Stripe" (from database... might not exist!)
```

**After (User-Driven):**
```
User fills guided form:
  Company: "Stripe"
  Role: "Security"
  Modernization Stage: "Evaluating & Comparing"
  AI Priority: "AI/ML Workloads"
  Email: security@stripe.com
↓
Use selections directly (no inference)
Company name from user (no lookup)
Still enrich email domain for additional context
```

### Benefits

1. **Accuracy**: No inference errors - users tell us exactly who they are
2. **Flexibility**: Works for ANY company (no database limitations)
3. **Rich Signals**: Captures AI priority (critical for AMD campaigns)
4. **Better UX**: Users feel in control of the experience
5. **Analytics**: All selections tracked for campaign optimization

---

## Key Features

### 1. RAD Enrichment Integration

**What It Does:**
- Extracts domain from work email (e.g., `john@microsoft.com` → `microsoft.com`)
- Calls Apollo.io and PeopleDataLabs APIs in parallel
- Gathers:
  - Company name, industry, size
  - Employee count, headquarters, founded year
  - Technology stack
  - Recent company news
  - Buying intent signals (early/mid/late stage)
- Resolves data conflicts using LLM consensus
- Returns enriched profile with confidence score (0.0-1.0)

**Files:**
- `/lib/enrichment/rad-client.ts` - Main enrichment client
- `/lib/supabase/queries.ts` - Caching functions
- `/supabase/migrations/002_add_enrichment_fields.sql` - Database schema

**Performance:**
- Target: 10-20 seconds for enrichment
- Caching: 24-hour TTL to reduce API costs
- Fallback: Mock enrichment if APIs unavailable

### 2. Template Selection Engine

**What It Does:**
- Maintains library of 20+ pre-written templates
- Each template targets specific persona/stage/industry/size combinations
- Scores templates based on:
  - Persona match (Business Leader, IT, Finance, Operations, Security)
  - Buyer stage match (awareness, evaluation, decision)
  - Industry relevance
  - Company size appropriateness
  - Enrichment confidence score
- Selects highest-scoring template

**Files:**
- `/lib/personalization/template-engine.ts` - Template library and selection logic

**Example Templates:**
- `exec-enterprise-evaluation`: "As {{company_name}} evaluates enterprise solutions..."
- `technical-mid-market-awareness`: "Technical teams at {{company_name}} are exploring..."
- `security-enterprise-evaluation`: "Security teams at {{company_name}} are evaluating..."

**Fallback Strategy:**
- If no high-confidence match, uses generic fallback templates
- Ensures content is always delivered, even with low enrichment quality

### 3. LLM Adaptation Layer

**What It Does:**
- Takes selected template + enrichment data
- Builds comprehensive context for Claude:
  - Company details (name, industry, size, news)
  - Persona characteristics (pain points, priorities)
  - Buyer stage urgency
- Instructs Claude to adapt template while maintaining:
  - Strict length requirements (headline: 6-12 words, etc.)
  - Professional tone (no superlatives, no exclamation marks)
  - Natural company name integration
  - Banned phrase avoidance (no competitors, no "revolutionary", etc.)
- Returns adapted content with validation

**Files:**
- `/lib/personalization/llm-adapter.ts` - Adaptation logic and prompts
- `/lib/anthropic/client.ts` - Claude API integration

**Safety Guardrails:**
- No competitor mentions
- No unverifiable claims ("best", "#1")
- No marketing jargon
- Length validation
- Tone validation

### 4. Enhanced Supabase Schema

**What It Stores:**

**personalization_jobs table:**
- User data: email, name (optional), domain
- Persona and buyer stage inference
- **NEW:** Full RAD enrichment fields:
  - company_name, industry, company_size
  - employee_count, headquarters, founded_year
  - technology (JSONB array)
  - news_summary, intent_signal
  - confidence_score, enrichment_sources
  - enrichment_timestamp, enrichment_duration_ms

**personalization_outputs table:**
- Generated content (headline, subheadline, CTA, value props)
- **NEW:** Template and performance metadata:
  - template_id, template_name
  - llm_model, llm_tokens_used
  - llm_latency_ms, total_latency_ms

**enrichment_cache table (NEW):**
- domain (unique key)
- enriched_data (JSONB)
- confidence_score
- cached_at, expires_at (24-hour TTL)
- cache_hits, last_accessed_at

**Files:**
- `/supabase/migrations/001_create_personalization_tables.sql` - Base schema
- `/supabase/migrations/002_add_enrichment_fields.sql` - Enrichment fields

### 5. Performance Optimization (<60s SLA)

**Target Breakdown:**
- RAD enrichment: 10-20s (parallel API calls)
- LLM conflict resolution: 2-5s (if needed)
- Template selection: <100ms (rule-based)
- Claude adaptation: 5-10s
- Database writes: 1-2s
- Network latency: 1-2s
- **Total: 20-40s typical, 60s max**

**Optimization Strategies:**
- **Parallel Processing:** Apollo + PeopleDataLabs APIs called simultaneously
- **Caching:** 24-hour enrichment cache per domain
- **Async Writes:** Non-critical database writes happen in background
- **Edge Functions:** Next.js API routes run on Vercel Edge for low latency

**Files:**
- `/lib/enrichment/rad-client.ts` - Implements caching and timeouts
- `/lib/supabase/queries.ts` - Cache management functions

### 6. Frontend Enhancements

**Email Form:**
- **NEW:** Optional name field for light personalization
- Work email field (required, validated)
- Consent checkbox (required)
- Real-time validation
- Submit button enabled only when valid

**Results Display:**
- Personalized headline
- Personalized subheadline
- 3 value propositions
- Persona-tailored CTA button
- Company/industry context display

**Files:**
- `/app/components/EmailForm.tsx` - Form with name field
- `/app/components/PersonalizedResults.tsx` - Content display
- `/app/page.tsx` - Main landing page

---

## Data Flow Example

### Example: john@microsoft.com submits form with CTA="compare"

**Step 1: Form Submission**
```json
{
  "email": "john@microsoft.com",
  "name": "John Smith",
  "cta": "compare",
  "consent": true
}
```

**Step 2: Extraction & Inference**
- Domain: `microsoft.com`
- Persona: `IT` (inferred from "john")
- Buyer Stage: `evaluation` (from "compare" CTA)

**Step 3: RAD Enrichment** (15 seconds)
```json
{
  "company_name": "Microsoft Corporation",
  "industry": "Technology",
  "company_size": "enterprise",
  "employee_count": "221,000",
  "headquarters": "Redmond, WA",
  "founded_year": 1975,
  "technology": ["Azure", "Windows", "Office 365"],
  "news_summary": "Microsoft reports strong cloud revenue growth...",
  "intent_signal": "mid",
  "confidence_score": 0.92,
  "sources_used": ["apollo", "peopledatalabs"]
}
```

**Step 4: Template Selection** (<1 second)
- Selected: `technical-enterprise-evaluation`
- Template intro: "Technical teams at {{company_name}} are evaluating {{industry}} platforms..."
- Template CTA: "Compare technical capabilities and integrations"

**Step 5: LLM Adaptation** (8 seconds)
- Filled template with Microsoft context
- Claude adapts tone and messaging
- Result:
```json
{
  "headline": "Enterprise Platform Evaluation for Microsoft",
  "subheadline": "As Microsoft's technical teams evaluate cloud-native platforms, see how enterprise leaders ensure seamless integration with Azure and Office 365 ecosystems.",
  "cta_text": "Compare integration capabilities",
  "value_prop_1": "Native Azure integration with zero-config deployment for enterprise scale",
  "value_prop_2": "Office 365 SSO and Teams integration for Microsoft-first organizations",
  "value_prop_3": "Enterprise security and compliance built for regulated industries"
}
```

**Step 6: Response** (24 seconds total)
```json
{
  "success": true,
  "jobId": 12345,
  "data": { /* personalized content */ },
  "enrichment": {
    "company_name": "Microsoft Corporation",
    "confidence_score": 0.92
  },
  "metadata": {
    "persona": "IT",
    "buyer_stage": "evaluation",
    "template_name": "Technical - Enterprise - Evaluation Stage",
    "total_latency_ms": 24000,
    "sla_met": true
  }
}
```

---

## File Structure & Locations

### Core Application Files

```
app/
├── page.tsx                        # Main landing page
├── layout.tsx                      # Root layout with metadata
├── api/
│   └── personalize/
│       └── route.ts               # Main API endpoint (UPDATED)
└── components/
    ├── EmailForm.tsx              # Email + name form (UPDATED)
    ├── PersonalizedResults.tsx    # Results display
    └── LoadingState.tsx           # Loading indicator

lib/
├── enrichment/
│   └── rad-client.ts              # RAD enrichment integration (NEW)
├── personalization/
│   ├── template-engine.ts         # Template selection (NEW)
│   └── llm-adapter.ts             # LLM adaptation (NEW)
├── anthropic/
│   ├── client.ts                  # Claude API client
│   └── mock-client.ts             # Mock for testing
├── supabase/
│   ├── client.ts                  # Supabase client
│   └── queries.ts                 # Database queries (UPDATED)
├── utils/
│   ├── email.ts                   # Email/persona utils
│   └── enrichment.ts              # Legacy mock enrichment
└── schemas.ts                     # Zod validation schemas (UPDATED)

supabase/
└── migrations/
    ├── 001_create_personalization_tables.sql  # Base schema
    └── 002_add_enrichment_fields.sql          # Enrichment fields (NEW)
```

### Configuration Files

```
setup/
└── stack.json                     # Stack configuration

scripts/
├── deploy-backend-supabase.sh    # Deploy Supabase migrations
└── deploy-frontend-vercel.sh     # Deploy Vercel frontend

Root:
├── next.config.mjs               # Next.js configuration
├── tsconfig.json                 # TypeScript configuration
├── vercel.json                   # Vercel deployment settings
├── playwright.config.ts          # Playwright test config
├── package.json                  # Dependencies and scripts
└── .env.example                  # Environment variable template
```

### Documentation Files

```
Root:
├── README.md                      # Project overview (NEEDS UPDATE)
├── INTEGRATION_PLAN.md            # RAD integration architecture (NEW)
├── FULL_EXPLANATION.md            # This file (NEW)
├── IMPLEMENTATION_SUMMARY.md      # Implementation details
├── FILE_LOCATIONS.md              # File location guide
├── MOCK_VS_REAL_COMPARISON.md     # Mock vs real comparison
├── REAL_COMPANY_TESTING.md        # Testing guide
├── PROJECT_EXPLANATION.txt        # Project explanation
├── QUICK_START_CARD.txt           # Quick start guide
└── WHAT_YOU_HAVE_NOW.txt          # Current state

<Claude.md is there for ENGINEERING PRINCIPLES>
